"use strict";function _instanceof(left,right){if(right!=null&&typeof Symbol!=="undefined"&&right[Symbol.hasInstance]){return!!right[Symbol.hasInstance](left)}else{return left instanceof right}}function _classCallCheck(instance,Constructor){if(!_instanceof(instance,Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var Select=function(){function Select(o){_classCallCheck(this,Select);_defineProperty(this,"cancel",false);_defineProperty(this,"dom",null);_defineProperty(this,"limit",10);_defineProperty(this,"speed",2);_defineProperty(this,"option",[]);_defineProperty(this,"suppose",null);_defineProperty(this,"change",null);_defineProperty(this,"miul",false);_defineProperty(this,"ic",false);_defineProperty(this,"focus_clear",false);_defineProperty(this,"key",'name');_defineProperty(this,"val",'value');_defineProperty(this,"placeholder",'请选择');_defineProperty(this,"selected",new Map());_defineProperty(this,"multiple",false);_defineProperty(this,"filter",null);Object.assign(this,o);this.option=JSON.parse(JSON.stringify(this.option));this.ev_listener={};this.p=0;this.init()}_createClass(Select,[{key:"init",value:function init(){this.dom.parentElement.replaceChild(this.create(),this.dom);this.data=this.option;this.add();this.input.oninput()}},{key:"create",value:function create(dom){var div=dom||document.createElement('div');div.innerHTML="<div class=\"select-container\"><div class=\"select-input-container\"><div class=\"selected-content\"></div><input class=\"select-input\" style=\"border: none;background: rgba(0,0,0,0);outline: none;flex: 1;width: 0px;\"type=\"text\"placeholder=\"".concat(this.placeholder,"\"/><span class=\"select-arrow\"></span></div><div class=\"select-box\"><ul class=\"select-box-content\"></ul><div class=\"select-scroll\"><div class=\"select-scroll-bar\"></div></div></div>");var style=document.createElement('style');style.id="select-style";style.innerHTML="\n            .el-icon-close {\n                background-color: #c0c4cc;\n                top: 0;\n                display: inline-block;\n                border-radius: 50%;\n                text-align: center;\n                position: relative;\n                cursor: pointer;\n                font-size: 12px;\n                height: 16px;\n                width: 16px;\n                line-height: 16px;\n                vertical-align: middle;\n                margin: -2px 2px 0 2px;\n                transform: scale(.8);\n            }\n\n            .el-icon-close:before{\n                display: block;\n                content: \"x\";\n                font-style: normal;\n                margin-top: -1px;\n            }\n\n            .selected-content {\n                display: contents;\n            }\n            \n            .test-span {\n                background-color: #f4f4f5;\n                border: 1px solid #e9e9eb;\n                color: #909399;\n                display: inline-block;\n                border-radius: 4px;\n                // margin: 2px;\n                // padding: 2px;\n                vertical-align: middle;\n                font-size: 12px;\n                padding: 2px 0px 2px 8px;\n                margin: 2px 5px 2px 0px;\n            }\n            .selected-content .test-span:nth-last-child(1){\n                margin-right:10px;\n            }\n            .test-span>span{\n                margin-right: 5px;\n            }\n            .select-container {\n                color: #333;\n                font-size: 14px;\n                position: relative;\n                width: 100%;\n                min-width: 100px;\n                background: #fff;\n            }\n            \n            .select-input {\n                min-width: 50px;\n            }\n            .select-input-container {\n                display: flex;\n                flex-flow: wrap;\n                width: 100%;\n                padding: 5px 20px 5px 12px;\n                color: #555;\n                background-image: none;\n                border: 1px solid#ccc;\n                border-radius: 4px;\n                min-height: 40px;\n                box-sizing: border-box;\n            }\n            \n            .select-input-container:hover {\n                color: #333;\n                background-color: #ebebeb;\n                border-color: #adadad\n            }\n            \n            .select-box {\n                position: absolute;\n                margin-top: 1px;\n                width: 100%;\n                top: 100%;\n                overflow: hidden;\n                user-select: none;\n                background: #fff;\n                z-index: 1000;\n                animation:  .1s 1 forwards;\n                transform-origin: 0px 0px;\n                display:flex;\n                transform: scaleY(0)\n            }\n            \n            @keyframes box-block {\n                from {\n                    transform: scaleY(0)\n                }\n            \n                to {\n                    transform: scaleY(1)\n                }\n            }\n            \n            @keyframes box-none {\n                from {\n                    transform: scaleY(1)\n                }\n            \n                to {\n                    transform: scaleY(0)\n                }\n            }\n            \n            .select-box-content {\n                width: 0px;\n                flex: 1;\n                padding: 0px;\n                margin: 0px;\n                border: 1px solid;\n                border-top: none;\n                border: 1px solid rgba(0,0,0,0.15);\n                border-radius: 4px;\n                text-align: left\n            }\n            \n            .select-box-content li {\n                padding: 3px 20px;\n                cursor: pointer;\n                white-space: nowrap;\n                transition: .5s;\n                text-overflow: ellipsis;\n                overflow: hidden;\n            }\n            \n            .select-box-content li:hover {\n                color: #262626;\n                text-decoration: none;\n                background: #428bca\n            }\n            \n            .select-li-active {\n                color: #428bca;\n                font-weight: bold;\n                position: relative;\n            }\n            \n            .select-li-active:before {\n                content: '\u221A';\n                position: absolute;\n                right: 5px;\n                font-family: \u9ED1\u4F53;\n            }\n            \n            .select-arrow {\n                width: 0;\n                height: 0;\n                border-width: 5px;\n                border-style: solid;\n                border-color: #000 transparent transparent transparent;\n                position: absolute;\n                right: 10px;\n                top: 50%;\n                transform: translate(0px,-25%)\n            }\n            \n            .select-scroll {\n                display: none;\n                background: #F1F1F1;\n                width: 10px;\n            }\n            \n            .select-scroll-bar {\n                transition: .2s;\n                margin: 0;\n                position: absolute;\n                right: 0px;\n                background: #C1C1C1;\n                width: 10px\n            }\n        ";!document.querySelector('#select-style')&&document.querySelector('head').appendChild(style);this.container=dom||div.querySelector('.select-container');this.selected_content=dom||div.querySelector('.selected-content');this.input=div.querySelector('.select-input');this.scroll=div.querySelector('.select-scroll');this.bar=div.querySelector('.select-scroll-bar');this.box_content=div.querySelector('.select-box-content');this.select_box=div.querySelector('.select-box');return this.container}},{key:"details",value:function details(o){var _this=this;return o.map(function(item,i){return"<li ".concat(_this.selected.has(item[_this.val])?'class="select-li-active"':''," title=\"").concat(item[_this.key],"\">").concat(item[_this.key],"</li>")})}},{key:"calcIndex",value:function calcIndex(arr,o){for(var i=0;i<arr.length;i++){if(arr[i]===o)return i}}},{key:"calcBar",value:function calcBar(){this.bar.style.height="".concat((this.limit/this.data.length*this.box_content.clientHeight).toFixed(2),"px ");this.bar.style.minHeight="5px";this.bar_offset=this.box_content.clientHeight-(parseInt(this.bar.style.height)<5?5:parseInt(this.bar.style.height))}},{key:"calcBarOffset",value:function calcBarOffset(){this.bar.style.top=this.p/(this.base_num||this.base_num+1)*(this.box_content.clientHeight-parseInt(this.bar.style.height))+'px';this.scroll.style.display=this.data.length<=this.limit?'none':'block'}},{key:"calcBase",value:function calcBase(){this.base_max_num=this.data.length-this.limit;this.base_num=this.data.length>this.limit?this.base_max_num:0}},{key:"on",value:function on(){var _arguments=arguments,_this2=this;this.ev_listener[arguments[0]]=function(ev){var all=document.querySelectorAll('.select-container');if([].find.call(all,function(item){return item===_this2.container}))_arguments[1](ev);else document.removeEventListener(_arguments[0],_this2.ev_listener[_arguments[0]],false)};document.addEventListener(arguments[0],this.ev_listener[arguments[0]],false)}},{key:"placeSelected",value:function placeSelected(){var _this3=this;this.selected_content.innerHTML=this.getSelected().map(function(item){return"<span class=\"test-span\"><span>".concat(item[_this3.key],"</span><i class=\"el-tag__close el-icon-close\" style=\"border-radius: 50%;\"></i></span>")}).join('')}},{key:"changeValue",value:function changeValue(o){var selected=this.selected.get(o[this.val]);if(selected){this.cancel&&this.selected.delete(o[this.val])}else{!this.multiple&&this.selected.clear();this.selected.set(o[this.val],o)}}},{key:"getSelected",value:function getSelected(){return Array.from(this.selected.values())}},{key:"filterData",value:function filterData(val,ev){var _this4=this;var data=this.option;var fn=this.filter||function(o){return(_this4.ic?o.item[_this4.key]:(o.item[_this4.key]+'').toLowerCase()).includes(o.text)};val.map(function(text){return data=data.filter(function(item,index){return fn({item:item,text:text,ev:ev,index:index,data:data})})});return data}},{key:"placeDetails",value:function placeDetails(){this.p=this.p>this.base_max_num?this.base_num:this.p<0?0:this.p;this.box_content.innerHTML=this.details(this.data.slice(this.p,this.p+this.limit)).join('')}},{key:"update",value:function update(){var _this5=this;var val=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var option=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.option;this.option=JSON.parse(JSON.stringify(option));this.selected.clear();[].concat(val).map(function(vals){var res=_this5.option.find(function(item){return item[_this5.val]==vals});res&&_this5.changeValue(res)});if(this.multiple)this.placeSelected();else this.setInputVal()}},{key:"relationBox",value:function relationBox(){var _this6=this;var box_all=document.querySelectorAll('.select-box');[].map.call(box_all,function(item){return item!=_this6.select_box&&item.style.animationName&&(item.style.animationName='box-none')})}},{key:"setInputVal",value:function setInputVal(){var selected=this.getSelected();this.input.value=this.multiple||!selected[0]?'':selected[0][this.key]}},{key:"copyText",value:function copyText(txt){var $textarea=document.createElement('textarea');$textarea.value=txt;document.body.appendChild($textarea);$textarea.select();document.execCommand("Copy");$textarea.remove()}},{key:"toggle",value:async function toggle(state){if(this.suppose&&(await this.suppose(state,this))===false)return;var style=this.select_box.style;if(state){style.animationName='box-block';this.input.value=''}else{style.animationName='box-none';this.setInputVal()}}},{key:"add",value:function add(){var _this7=this;this.input.oninput=function(ev){var val=_this7.input.value.trim();val=_this7.ic?[val]:[(val+'').toLowerCase()];_this7.miul&&(val=val[0].replace(/\s+/g,' ').split(' '));_this7.data=_this7.filterData(val,ev);_this7.p=_this7.calcIndex(_this7.data,_this7.getSelected()[0])||0;_this7.calcBase();_this7.placeDetails();_this7.calcBar();_this7.calcBarOffset()};this.input.onmousedown=function(ev){return _this7.scroll_ing=true};this.input.onfocus=async function(ev){await _this7.toggle(true);_this7.input.oninput();_this7.relationBox()};this.box_content.onmousewheel=function(ev){_this7.bar.style.transition='';_this7.p+=parseInt(ev.wheelDelta>0?-_this7.speed:_this7.speed);_this7.placeDetails();_this7.calcBarOffset();return false};this.scroll.onmousedown=function(ev){var sy=ev.offsetY>_this7.bar_offset?_this7.bar_offset:ev.offsetY;_this7.bar.style.top=sy+'px';_this7.p=(ev.offsetY/_this7.bar_offset*_this7.base_max_num).toFixed()-0;_this7.placeDetails()};this.bar.onmousedown=function(e){var base_y=e.y;_this7.bar.style.transition='none';_this7.scroll_ing=true;e.stopPropagation();_this7.on('mousemove',function(ev){var sy=parseInt(_this7.bar.style.top||0)+(ev.y-base_y);sy=sy>_this7.bar_offset?_this7.bar_offset:sy<0?0:sy;_this7.bar.style.top=sy+'px';base_y=ev.y;_this7.p=(sy/_this7.bar_offset*_this7.base_max_num).toFixed()-0;_this7.placeDetails()});_this7.on('mouseup',function(ev){_this7.bar.style.transition='';ev.path.find(function(item){return item.className==='select-container'})&&(_this7.scroll_ing=false);document.removeEventListener('mousemove',_this7.ev_listener['mousemove'],false);document.removeEventListener('mouseup',_this7.ev_listener['mouseup'],false)})};this.container.oncontextmenu=function(){return false};this.container.onmouseup=function(ev){if(ev.target.localName!=='li')return;ev.button==2&&_this7.copyText(ev.target.innerText)};this.container.onclick=async function(ev){if(ev.target.localName==='li'){var index=_this7.calcIndex(_this7.box_content.children,ev.target);var res=_this7.data.slice(_this7.p,_this7.p+_this7.limit)[index];_this7.changeValue(res);_this7.placeDetails();_this7.multiple&&_this7.placeSelected();_this7.toggle(false);_this7.change&&_this7.change(res,_this7.getSelected(),ev.target,_this7)}if(ev.target.className.includes('el-icon-close')){var list=_this7.selected_content.querySelectorAll('.el-icon-close');var _index=_this7.calcIndex(list,ev.target);var _res=_this7.getSelected()[_index];_this7.selected.delete(_res[_this7.val]);_this7.placeDetails();_this7.placeSelected()}};this.on('click',async function(ev){var box=ev.path.find(function(item){return item.className==='select-box'});!box&&!_this7.scroll_ing&&_this7.select_box.style.animationName=='box-block'&&(await _this7.toggle(false));_this7.scroll_ing=false})}}]);return Select}();
export default Select